<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>キータイピングゲーム</title>
    <style>
        /* ここにCSSスタイルを追加できます */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh; /* 画面の高さいっぱいに表示 */
            margin: 0;
        }

        /* 正解文字の色設定 */
        .correct-char {
            color: red;
        }
    </style>
</head>
<body>

<center>
    <h1 id="start" class="text-center">スタートボタンを押して下さい</h1>
    <button id="startButton" onclick="startGame()">スタート</button>
    <button id="retryButton" onclick="startGame()">もう一度</button>
</center>

<script>
    // 問題一覧
    // const questions = ["apple", "banana", "melon", "mango", "strawberry", "blueberry", "orange"];
    const questions = ["apple", "banana", "melon", "mango", "orange"];

    // 現在の問題番号
    let currentQuestionIndex = -1;

    // 現在の正解判定位置
    let currentCharIndex = 0;

    // スタートボタン
    const startButton = document.getElementById("startButton");

    // リトライボタン
    const retryButton = document.getElementById("retryButton");
    retryButton.style.display = "none"; // リトライボタンを予め非表示にする

    // ゲームが終了したかどうかを示すフラグ
    let gameEnded = false;

    // スタートボタンクリック時の関数
    function startGame() {
        currentQuestionIndex = -1;
        nextQuestion(); // 最初の問題を表示
        startButton.style.display = "none"; // スタートボタンを非表示にする
        retryButton.style.display = "none"; // リトライボタンを非表示にする
        gameEnded = false; // ゲームが再スタートされたのでフラグをリセット
    }

    function handleKeyDown(event) {
        if (gameEnded) return; // ゲームが終了した場合、入力を受け付けない

        const keyPressed = event.key;

        // 押されたキーが正解かどうかを判定
        if (questions[currentQuestionIndex].charAt(currentCharIndex) === keyPressed) {
            currentCharIndex++;

            // 問題が全て正解した場合
            if (currentCharIndex === questions[currentQuestionIndex].length) {
                if (currentQuestionIndex === questions.length - 1) {
                    // 最後の問題をクリアした場合、ゲーム終了
                    gameEnded = true;
                    retryButton.style.display = "block"; // スタートボタンを再表示
                    document.getElementById("start").textContent = "ゲーム終了！\n再プレイするにはスタートボタンをクリックしてください";
                } else {
                    nextQuestion(); // 次の問題を表示
                }
            } else {
                displayCurrentQuestion(); // 正解文字を色分けして表示
            }
        }
    }

    // キーボード入力時のイベントリスナー
    window.addEventListener("keydown", handleKeyDown);

    // ランダムな問題番号を取得
    function getRandomQuestionIndex() {
        return Math.floor(Math.random() * questions.length);
    }

    // 次の問題を表示
    function nextQuestion() {
        currentQuestionIndex = getRandomQuestionIndex();
        currentCharIndex = 0;
        displayCurrentQuestion();
    }

    // 現在の問題を表示
    function displayCurrentQuestion() {
        const questionElement = document.getElementById("start");
        const currentQuestion = questions[currentQuestionIndex];

        // 正解文字と非正解文字を色分けして表示
        let questionHTML = "";
        for (let i = 0; i < currentQuestion.length; i++) {
            if (i < currentCharIndex) {
                questionHTML += `<span class="correct-char">${currentQuestion.charAt(i)}</span>`;
            } else {
                questionHTML += currentQuestion.charAt(i);
            }
        }
        questionElement.innerHTML = questionHTML;
    }
</script>

</body>
</html>
